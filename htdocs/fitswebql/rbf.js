const rbf_centres = [[0.35689510301491456, 0.4086939419921549, 0.9022950986410274], [0.21410045188640492, 0.8186926004705914, 0.6933284136579181], [0.939172248311561, 0.5269533721324422, 0.08202095095410722], [0.7432988087335808, 0.3672640323381551, 0.8254148426087289], [0.3644430534073717, 0.5739856070419134, 0.04652431705431659], [0.6271690952276159, 0.5154507975000622, 0.528503612966249], [0.07840628226536794, 0.5671427396817397, 0.2330740081812095], [0.4937246371327044, 0.14841422226401746, 0.8989454445881315], [0.6329646416082859, 0.8695719125981671, 0.8642016958790251], [0.5531941906420856, 0.28958795171283946, 0.4055057453181583], [0.7933489424995919, 0.9716982200265287, 0.531686122323582], [0.11559810417642358, 0.6454628656546846, 0.5521811733979436], [0.5549456779680082, 0.0650666656609209, 0.04155006504823655], [0.024438961689331018, 0.40447765215646037, 0.23195616842913025], [0.0725316039156696, 0.4747325320162108, 0.9190382783755979], [0.36254367016221245, 0.26099840509774475, 0.004264658079508932], [0.5805431145018483, 0.8687860256457296, 0.08291516962846801], [0.8255985645269526, 0.9115231117313853, 0.42507921720794606], [0.9725519104049538, 0.06263512182838449, 0.6475597878330093], [0.7915652265482607, 0.3161539345866524, 0.13308971029787742], [0.1309732738045859, 0.4849078903486508, 0.9693714982855077], [0.07347390170089652, 0.5888233794510052, 0.7321184436383525], [0.5365149807889751, 0.3171709816215069, 0.3434706323916321], [0.7642269726599875, 0.08155434407681739, 0.9721447664354954], [0.8949832235934401, 0.7906699681656459, 0.15151227541170953], [0.3115255223747406, 0.2765698222433648, 0.913154061987214], [0.540451921831139, 0.08779278928132839, 0.30730170868840734], [0.9418433571811331, 0.7979886815593018, 0.5321681996384597], [0.42027704010086375, 0.3658432735563171, 0.03548902448323843], [0.03859853625659326, 0.20914094984604503, 0.2885728389590525]];
const rbf_wts = [-116.24897510694107, -294341.9756107483, 32128.84472962006, -125862.03973077345, -68216.92728485257, -54264.36238674522, 188849.27364119526, 163756.68671348266, -493340.7841942372, -12922.43170743871, 724007.7308123747, 110620.39460223977, -312763.43891254556, 57804.06344840819, -73481.15562747489, -557679.047024829, -236362.87269266316, -19216.31968347307, -204717.2107598445, -38022.57899076642, 65050.308411405764, 300863.5631868165, 385181.1898128437, -875955.2567287887, 185906.50009233115, 146065.4826721665, 627690.3255576347, 27623.792056300877, 15042.867542512357, 302305.04052150686, 38750.89530678402];

dot = (a, b) => a.map((_, i) => a[i] * b[i]).reduce((m, n) => m + n);
sqnorm = (a, b) => (dot(a, a) + dot(b, b) - 2 * dot(a, b));

function rbf_kernel(x, y, gamma) {
    let z = sqnorm(x, y);
    return Math.exp(-gamma * z);
}

function rbf_compute(x) {
    let hh = rbf_centres.map(function (centre) {
        return rbf_kernel(x, centre, 1.0);
    });

    // prepend 1.0 to the array
    hh.unshift(1.0);

    // console.log("hh:", hh);

    // clamp the output to [0, 1]
    return clamp(dot(hh, rbf_wts), 0.0, 1.0);
    // return dot(hh, rbf_wts);
}

const inputs = [r / 255, g / 255, b / 255];

let start = performance.now();
let raw_intensity = rbf_compute(inputs);
let elapsed = Math.round(performance.now() - start);
